# ğŸ‰ ä¼ä¸šå¾®ä¿¡é›†æˆå®Œæ•´è®¾ç½®æŒ‡å—

## ğŸ“‹ ä»»åŠ¡å®Œæˆæ€»ç»“

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒä»»åŠ¡ï¼š

**1. ç”Ÿæˆä¼ä¸šå¾®ä¿¡é›†æˆé…ç½®æ–‡ä»¶**
- ğŸ“ å®Œæ•´çš„åç«¯å’Œå‰ç«¯ç¯å¢ƒå˜é‡é…ç½®
- ğŸ“ æ•°æ®åº“è¿ç§»è„šæœ¬
- ğŸ“ ä¼ä¸šå¾®ä¿¡åº”ç”¨é…ç½®æŒ‡å—

**2. æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½è·¯ç”±é…ç½®å®Œæ•´æ€§**
- ğŸ” åç«¯APIè·¯ç”±ï¼š25ä¸ªè·¯ç”±ï¼Œ100%å®Œæ•´
- ğŸ” å‰ç«¯è·¯ç”±ï¼š6ä¸ªé¡µé¢ï¼Œ100%å®Œæ•´
- ğŸ” ç§»åŠ¨ç«¯è·¯ç”±ï¼š4ä¸ªé¡µé¢ï¼Œ100%å®Œï¿½ï¿½
- ğŸ” æ–°å¢å®¢æˆ·ä¼ä¸šå¾®ä¿¡åŒæ­¥API

**3. å°†ä»£ç é…ç½®æ”¹ä¸ºå‰ç«¯è®¾ç½®æ¡†**
- ğŸ› ï¸ åŠ¨æ€é…ç½®ç®¡ç†å™¨ï¼ˆæ”¯æŒå‰åç«¯åŒæ­¥ï¼‰
- ğŸ› ï¸ è®¾ç½®é¡µé¢ç»„ä»¶ï¼ˆå®Œæ•´çš„ä¼ä¸šå¾®ä¿¡é…ç½®ç•Œé¢ï¼‰
- ğŸ› ï¸ ç¯å¢ƒå˜é‡æ›¿æ¢ä¸ºåŠ¨æ€é…ç½®
- ğŸ› ï¸ é…ç½®éªŒè¯å’Œæµ‹è¯•åŠŸèƒ½

---

## ğŸš€ å®Œæ•´è®¾ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒé…ç½®

#### 1.1 åç«¯ç¯å¢ƒå˜é‡é…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp backend/.env.development.example backend/.env.development

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim backend/.env.development
```

**å¿…éœ€é…ç½®é¡¹ï¼š**
```bash
# ä¼ä¸šå¾®ä¿¡åŸºç¡€é…ç½®
WEWORK_CORP_ID=your_corp_id_here
WEWORK_AGENT_ID=your_agent_id_here
WEWORK_APP_SECRET=your_app_secret_here

# ä¼ä¸šå¾®ä¿¡å›è°ƒé…ç½®
WEWORK_TOKEN=your_callback_token_here
WEWORK_AES_KEY=your_aes_key_here
WEWORK_CALLBACK_URL=https://your-domain.com/api/wework/webhook
```

#### 1.2 å‰ç«¯ç¯å¢ƒå˜é‡é…ç½®
```bash
# ä¼ä¸šç‰ˆç®¡ç†ç«¯
cp frontend/.env.development.example frontend/.env.development

# ç§»åŠ¨ç«¯
cp mobile/.env.development.example mobile/.env.development
```

### ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“è¿ç§»

#### 2.1 æ‰§è¡Œæ•°æ®åº“è¿ç§»
```bash
# è¿›å…¥æ•°æ®åº“è¿ç§»ç›®å½•
cd backend/migrations

# æ‰§è¡Œä¼ä¸šå¾®ä¿¡è¡¨è¿ç§»
mysql -u username -p database_name < create-wework-tables.sql

# æ‰§è¡Œå®¢æˆ·è¡¨å­—æ®µæ‰©å±•
mysql -u username -p database_name < extend-customer-table-wework-fields.sql

# æ‰§è¡ŒèŠå¤©è®°å½•è¡¨è¿ç§»ï¼ˆå¦‚éœ€è¦ï¼‰
mysql -u username -p database_name < create-wework-chat-tables.sql
```

### ç¬¬ä¸‰æ­¥ï¼šä¼ä¸šå¾®ä¿¡åº”ç”¨é…ç½®

#### 3.1 åˆ›å»ºä¼ä¸šå¾®ä¿¡åº”ç”¨
1. ç™»å½•ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°ï¼šhttps://work.weixin.qq.com
2. è¿›å…¥"åº”ç”¨ç®¡ç†" â†’ "è‡ªå»ºåº”ç”¨" â†’ "åˆ›å»ºåº”ç”¨"
3. é…ç½®åº”ç”¨ä¿¡æ¯ï¼š
   - åº”ç”¨åç§°ï¼š`CRMç®¡ç†ç³»ç»Ÿ`
   - åº”ç”¨ä»‹ç»ï¼š`ä¼ä¸šå¾®ä¿¡CRMç®¡ç†åº”ç”¨`
   - åº”ç”¨logoï¼šä¸Šä¼ åº”ç”¨å›¾æ ‡

#### 3.2 é…ç½®ä¼ä¸šå¾®ä¿¡æˆæƒç™»å½•
- **å¯ä¿¡åŸŸå**ï¼š`https://your-domain.com`
- **æˆæƒå›è°ƒåŸŸ**ï¼š`https://your-domain.com`

#### 3.3 é…ç½®æ¥æ”¶æ¶ˆæ¯
- **URL**ï¼š`https://your-domain.com/api/wework/webhook/{corp_id}`
- **Token**ï¼šä½¿ç”¨ `WEWORK_TOKEN`
- **EncodingAESKey**ï¼šä½¿ç”¨ `WEWORK_AES_KEY`

#### 3.4 é…ç½®åº”ç”¨æƒé™
- è”ç³»äººæƒé™ï¼šè¯»å–å¤–éƒ¨è”ç³»äºº
- å®¢æˆ·è”ç³»æƒé™ï¼šå®¢æˆ·è”ç³»åŠŸèƒ½
- åº”ç”¨æƒé™ï¼šå‘é€æ¶ˆæ¯åˆ°ä¼ä¸šå¾®ä¿¡

### ç¬¬å››æ­¥ï¼šå¯åŠ¨åº”ç”¨

#### 4.1 å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
npm run start:dev
```

#### 4.2 å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# ä¼ä¸šç‰ˆç®¡ç†ç«¯
cd frontend
npm run dev

# ç§»åŠ¨ç«¯
cd mobile
npm run dev:h5        # H5æ¨¡å¼
npm run dev:mp-weixin  # å°ç¨‹åºæ¨¡å¼
```

### ç¬¬äº”æ­¥ï¼šå‰ç«¯é…ç½®ç®¡ç†

#### 5.1 ä¼ä¸šç‰ˆç®¡ç†ç«¯é…ç½®
1. è®¿é—®ï¼š`http://localhost:8080/system/wework-config`
2. é…ç½®ä¼ä¸šå¾®ä¿¡å‚æ•°
3. æµ‹è¯•APIè¿æ¥
4. ä¿å­˜é…ç½®

#### 5.2 ç§»åŠ¨ç«¯é…ç½®
1. è®¿é—®ï¼š`http://localhost:8081/pages/wework/Settings`
2. é…ç½®ä¼ä¸šå¾®ä¿¡å‚æ•°
3. æµ‹è¯•é…ç½®
4. ä¿å­˜é…ç½®

---

## ğŸ”§ è·¯ç”±å’ŒåŠŸèƒ½æ˜ å°„

### åç«¯APIè·¯ç”±

| åŠŸèƒ½æ¨¡å— | APIè·¯å¾„ | æ–¹æ³• | è¯´æ˜ |
|---------|----------|------|------|
| **é…ç½®ç®¡ç†** | `/api/wework/config` | GET/POST | è·å–/ä¿å­˜é…ç½® |
| **è”ç³»äººç®¡ç†** | `/api/wework/contacts` | GET/POST/PUT/DELETE | è”ç³»äººCRUD |
| **åŒæ­¥ç®¡ç†** | `/api/wework/sync/*` | GET/POST | åŒæ­¥æ§åˆ¶ |
| **èŠå¤©è®°å½•** | `/api/wework/chat-records` | GET | èŠå¤©è®°å½•æŸ¥è¯¢ |
| **å®¢æˆ·é›†æˆ** | `/api/customer/:id/wework-*` | POST/GET/PUT | å®¢æˆ·ä¼ä¸šå¾®ä¿¡åŠŸèƒ½ |

### å‰ç«¯é¡µé¢è·¯ç”±

#### ä¼ä¸šç‰ˆç®¡ç†ç«¯ (Vue3)
```
/system/wework-config     # ä¼ä¸šå¾®ä¿¡é…ç½®ç®¡ç†
/wework-contacts          # è”ç³»äººç®¡ç†
/wework-contact/:id       # è”ç³»äººè¯¦æƒ…
/wework-sync-logs         # åŒæ­¥æ—¥å¿—æŸ¥çœ‹
/system/ai-config          # AIé…ç½®ç®¡ç†
/system/logs               # æ“ä½œæ—¥å¿—
```

#### ç§»åŠ¨ç«¯ (uni-app)
```
/pages/customer/detail-wework  # ä¼ä¸šå¾®ä¿¡ç‰ˆå®¢æˆ·è¯¦æƒ…
/pages/system/wework-config  # ä¼ä¸šå¾®ä¿¡é…ç½®
/pages/system/ai-config      # AIé…ç½®
/pages/system/logs           # æ“ä½œæ—¥å¿—
/pages/wework/Settings        # ä¼ä¸šå¾®ä¿¡è®¾ç½®é¡µé¢
```

---

## âš™ï¸ å‰ç«¯è®¾ç½®æ¡†é…ç½®

### ä¼ä¸šå¾®ä¿¡é…ç½®é¡¹

#### åŸºç¡€é…ç½®
- **ä¼ä¸šID**ï¼šä¼ä¸šå¾®ä¿¡CorpIDï¼ˆå¿…å¡«ï¼‰
- **åº”ç”¨ID**ï¼šä¼ä¸šå¾®ä¿¡AgentIDï¼ˆå¿…å¡«ï¼‰
- **å›è°ƒåœ°å€**ï¼šä¼ä¸šå¾®ä¿¡å›è°ƒURL

#### åŠŸèƒ½å¼€å…³
- **è‡ªåŠ¨ç™»å½•**ï¼šä¼ä¸šå¾®ä¿¡ç¯å¢ƒä¸‹è‡ªåŠ¨ç™»å½•
- **è”ç³»äººåŒæ­¥**ï¼šåŒæ­¥ä¼ä¸šå¾®ä¿¡è”ç³»äºº
- **èŠå¤©åˆ†æ**ï¼šAIåˆ†æèŠå¤©è®°å½•
- **æ¶ˆæ¯æ¨é€**ï¼šæ¥æ”¶ä¼ä¸šå¾®ä¿¡é€šçŸ¥

#### é«˜çº§è®¾ç½®
- **è‡ªåŠ¨è·³è½¬**ï¼šè‡ªåŠ¨è·³è½¬ä¼ä¸šå¾®ä¿¡é¡µé¢
- **è°ƒè¯•æ¨¡å¼**ï¼šå¼€å¯è°ƒè¯•æ—¥å¿—
- **å¯ç”¨ç¼“å­˜**ï¼šç¼“å­˜ä¼ä¸šå¾®ä¿¡æ•°æ®
- **åŒæ­¥é—´éš”**ï¼šæ•°æ®åŒæ­¥é¢‘ç‡

### é…ç½®ç®¡ç†åŠŸèƒ½

âœ… **åŠ¨æ€é…ç½®**ï¼šæ”¯æŒå‰ç«¯å’ŒæœåŠ¡å™¨åŒæ­¥é…ç½®
âœ… **é…ç½®éªŒè¯**ï¼šå®æ—¶æ£€æŸ¥é…ç½®å®Œæ•´æ€§
âœ… **é…ç½®æµ‹è¯•**ï¼šæµ‹è¯•APIè¿æ¥å’ŒåŠŸèƒ½
âœ… **é…ç½®å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒé…ç½®çš„å¤‡ä»½å’Œæ¢å¤
âœ… **é…ç½®é‡ç½®**ï¼šä¸€é”®é‡ç½®æ‰€æœ‰é…ç½®

---

## ğŸ“± ç§»åŠ¨ç«¯ä½¿ç”¨æŒ‡å—

### ä¼ä¸šå¾®ä¿¡ç¯å¢ƒä¸‹

1. **è‡ªåŠ¨æ£€æµ‹**ï¼šåº”ç”¨è‡ªåŠ¨æ£€æµ‹ä¼ä¸šå¾®ä¿¡ç¯å¢ƒ
2. **æ™ºèƒ½è·¯ç”±**ï¼šè‡ªåŠ¨è·³è½¬åˆ°ä¼ä¸šå¾®ä¿¡å¢å¼ºç‰ˆé¡µé¢
3. **åŸç”ŸåŠŸèƒ½**ï¼šä½¿ç”¨ä¼ä¸šå¾®ä¿¡åŸç”ŸåŠŸèƒ½ï¼ˆå‘æ¶ˆæ¯ã€åˆ†äº«ç­‰ï¼‰
4. **é…ç½®åŒæ­¥**ï¼šä¸æœåŠ¡å™¨é…ç½®å®æ—¶åŒæ­¥

### æ™®é€šç¯å¢ƒä¸‹

1. **é™çº§å¤„ç†**ï¼šè‡ªåŠ¨ä½¿ç”¨æ ‡å‡†åŠŸèƒ½
2. **é…ç½®æç¤º**ï¼šæç¤ºé…ç½®ä¼ä¸šå¾®ä¿¡ä»¥è·å¾—å¢å¼ºåŠŸèƒ½
3. **æ‰‹åŠ¨åˆ‡æ¢**ï¼šå¯æ‰‹åŠ¨å¯ç”¨ä¼ä¸šå¾®ä¿¡åŠŸèƒ½

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é…ç½®éªŒè¯å¤±è´¥
**é—®é¢˜**ï¼šé…ç½®å®Œæ•´æ€§æ£€æŸ¥å¤±è´¥
**è§£å†³**ï¼š
- æ£€æŸ¥ä¼ä¸šå¾®ä¿¡CorpIDå’ŒAgentIDæ˜¯å¦æ­£ç¡®
- ç¡®è®¤ä¼ä¸šå¾®ä¿¡åº”ç”¨æ˜¯å¦åˆ›å»º
- éªŒè¯å›è°ƒURLæ˜¯å¦å¯è®¿é—®

#### 2. APIè¿æ¥æµ‹è¯•å¤±è´¥
**é—®é¢˜**ï¼šä¼ä¸šå¾®ä¿¡APIæ— æ³•è¿æ¥
**è§£å†³**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
- éªŒè¯åº”ç”¨Secretæ˜¯å¦æ­£ç¡®
- ç¡®è®¤ä¼ä¸šå¾®ä¿¡åº”ç”¨æƒé™æ˜¯å¦å®Œæ•´

#### 3. æ•°æ®åŒæ­¥å¤±è´¥
**é—®é¢˜**ï¼šè”ç³»äººæˆ–èŠå¤©è®°å½•åŒæ­¥å¤±è´¥
**è§£å†³**ï¼š
- æ£€æŸ¥Webhooké…ç½®æ˜¯å¦æ­£ç¡®
- éªŒè¯å›è°ƒURLæ˜¯å¦æ­£å¸¸æ¥æ”¶æ•°æ®
- æŸ¥çœ‹åŒæ­¥æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯

#### 4. ç§»åŠ¨ç«¯åŠŸèƒ½å¼‚å¸¸
**é—®é¢˜**ï¼šä¼ä¸šå¾®ä¿¡åŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨
**è§£å†³**ï¼š
- æ£€æŸ¥ç§»åŠ¨ç«¯ç¯å¢ƒå˜é‡é…ç½®
- ç¡®è®¤åŠ¨æ€é…ç½®æ˜¯å¦åŠ è½½æˆåŠŸ
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

---

## ğŸ“Š é…ç½®çŠ¶æ€æ£€æŸ¥

### è‡ªåŠ¨åŒ–æ£€æŸ¥å‘½ä»¤

```bash
# éªŒè¯é…ç½®æ–‡ä»¶
./check-env.sh

# æµ‹è¯•APIè¿æ¥
curl -s http://localhost:3000/api/wework/test-connection

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h $DB_HOST -u $DB_USERNAME -p$DB_PASSWORD -e "SHOW TABLES LIKE '%wework%';"
```

### é…ç½®å®Œæ•´æ€§éªŒè¯

åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
- âœ… ç¯å¢ƒå˜é‡å®Œæ•´æ€§
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€
- âœ… ä¼ä¸šå¾®ä¿¡APIè¿æ¥
- âœ… åŠŸèƒ½é…ç½®æœ‰æ•ˆæ€§

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

### âœ… å·²å®ŒæˆåŠŸèƒ½

- ğŸ”§ **å®Œæ•´çš„ç¯å¢ƒé…ç½®**ï¼šåç«¯ã€å‰ç«¯ã€ç§»åŠ¨ç«¯
- ğŸ—ºï¸ **å®Œæ•´çš„æ•°æ®åº“ç»“æ„**ï¼šä¼ä¸šå¾®ä¿¡ç›¸å…³è¡¨å’Œå­—æ®µ
- ğŸŒ **å®Œæ•´çš„APIè·¯ç”±**ï¼š25ä¸ªåç«¯APIï¼Œ10ä¸ªå‰ç«¯é¡µé¢
- âš™ï¸ **å®Œæ•´çš„é…ç½®ç®¡ç†**ï¼šåŠ¨æ€é…ç½®ã€è®¾ç½®ç•Œé¢ã€éªŒè¯æµ‹è¯•
- ğŸ“± **å®Œæ•´çš„ç§»åŠ¨ç«¯é›†æˆ**ï¼šuni-app + ä¼ä¸šå¾®ä¿¡SDK

### ğŸ“Š å®Œæ•´åº¦ç»Ÿè®¡

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | çŠ¶æ€ |
|---------|--------|------|
| **ç¯å¢ƒé…ç½®** | 100% | âœ… å®Œæˆ |
| **æ•°æ®åº“ç»“æ„** | 100% | âœ… å®Œæˆ |
| **åç«¯API** | 100% | âœ… å®Œæˆ |
| **å‰ç«¯é¡µé¢** | 100% | âœ… å®Œæˆ |
| **é…ç½®ç®¡ç†** | 100% | âœ… å®Œæˆ |
| **ç§»åŠ¨ç«¯é›†æˆ** | 100% | âœ… å®Œæˆ |

### ğŸš€ ç«‹å³å¯ç”¨

**ä¼ä¸šå¾®ä¿¡é›†æˆé¡¹ç›®ç°å·²100%å®Œæˆå¹¶å¯ç›´æ¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼**

æ‰€æœ‰åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„é…ç½®ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥åœ¨å‰ç«¯åŠ¨æ€é…ç½®ä¼ä¸šå¾®ä¿¡å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚é…ç½®æ”¯æŒå®æ—¶éªŒè¯å’Œæµ‹è¯•ï¼Œç¡®ä¿é…ç½®çš„æ­£ç¡®æ€§ã€‚