# 教育培训 CRM+OA+OKR 系统

## 项目简介

这是一个专为教育培训机构打造的企业级管理平台，集成了客户关系管理（CRM）、订单管理、财务统计、OKR绩效考核和数据可视化等功能。

### 核心功能

✅ **已实现功能**

#### 📊 业务管理模块

- **CRM客户管理**
  - 客户列表（搜索、筛选、分页）
  - 客户详情（基本信息、跟进记录、订单历史）
  - 跟进记录添加与时间线展示
  - 回访提醒（仪表盘自动显示待回访客户）
  - 客户意向分级（高/中/低）
  - 数据导出Excel功能

- **订单管理**
  - 订单列表（多条件搜索、状态筛选）
  - 订单CRUD（新增、编辑、删除）
  - Excel订单批量导入导出
  - 智能客户关联（微信号/手机号匹配）
  - 新老学员自动判定（3个月规则）
  - 订单看板（统计图表、状态分布）
  - 自动触发提成计算

- **财务统计**
  - 财务概览（总收入、退款统计、平均客单价）
  - 收入趋势分析（按日/按月）
  - 销售排行榜（Top 10）
  - 校区收入对比
  - 课程收入统计
  - 财务报表导出（多Sheet Excel）

- **提成管理**
  - 订单自动计算提成（按角色配置比例）
  - 提成列表（筛选、统计）
  - 单笔/批量发放提成
  - 提成记录导出
  - 提成统计分析

- **OKR管理**
  - OKR创建（含多个关键结果KR）
  - 关键结果进度更新
  - 自动计算OKR完成度（基于KR权重）
  - OKR统计看板
  - 个人/团队/公司OKR分类

#### 🏢 系统管理模块

- **用户管理**
  - 用户CRUD（含部门/校区关联）
  - 密码重置、状态启用/禁用
  - 按部门/校区/角色筛选
  - 6种角色（管理员、销售经理、销售、校区经理、运营、财务）

- **部门管理**
  - 树形结构展示
  - 部门CRUD、负责人设置
  - 删除前检查（子部门、员工）

- **校区管理**
  - 校区CRUD、负责人设置
  - 校区编码唯一性验证
  - 删除前检查（员工、订单）

- **字典管理**
  - 系统字典CRUD
  - 按类型分组管理
  - 预置字典（客户意向、流量来源、订单状态）
  - 一键初始化默认数据

- **个人中心**
  - 个人资料查看/编辑
  - 修改密码（原密码验证）
  - 个人信息卡片展示

- **操作日志**
  - 日志记录与查询
  - 多维度筛选
  - 详情查看
  - 定期清理

#### 📈 数据展示模块

- **管理看板**
  - 实时今日数据（新增客户、新增订单、今日收入）
  - 总体数据概览（客户总数、订单总数、累计收入、本月收入）
  - 近7天收入趋势图
  - 客户意向分布饼图
  - 订单状态分布环形图
  - 新老学员占比饼图
  - 待回访客户列表（含逾期提醒）

- **数据大屏**（1920×1080全屏）
  - 实时时间显示
  - 核心指标卡片
  - 多维度数据图表
  - 30秒自动刷新
  - 深色主题设计

#### 🔐 权限安全模块

- **认证授权**
  - JWT身份认证
  - 基于角色的数据权限（RBAC）
  - 数据范围隔离（销售只看自己的、主管看部门、管理员看全部）

#### 🛠️ 增强功能模块

- **数据导出**
  - 客户列表导出Excel
  - 订单列表导出Excel
  - 提成记录导出Excel
  - 财务报表导出（多Sheet）

- **操作日志系统**
  - 自动记录所有关键操作
  - 日志列表查询与筛选
  - 按用户/模块/状态/时间筛选
  - 详细的操作信息展示
  - IP地址和User-Agent记录
  - 敏感信息自动脱敏
  - 定期清理旧日志功能

- **消息通知系统**
  - 回访提醒（定时任务自动检查）
  - 订单状态更新通知
  - 提成发放通知
  - 系统通知
  - 消息中心页面
  - 顶部未读消息徽章
  - 标记已读/批量已读
  - 清空已读消息

- **文件上传功能**
  - 用户头像上传
  - 客户附件管理
  - 订单合同上传
  - 文件类型和大小验证
  - 文件预览和下载
  - 关联文件查询
  - 文件删除（含物理文件）

### 技术栈

**前端**
- Vue 3.4 + TypeScript 5.3
- Element Plus 2.5（黄色主题定制）
- Pinia 2（状态管理）
- Vue Router 4
- ECharts 5（数据可视化）
- Vite 5

**后端**
- Node.js 20 LTS + Nest.js 10
- TypeORM 0.3 + MySQL 8.0
- Redis 7（缓存+会话）
- JWT（身份认证）
- Swagger（API文档）

**部署**
- Docker + Docker Compose（容器化部署）
- GitHub Actions（自动化CI/CD）
- Nginx（反向代理）
- 阿里云/腾讯云轻量应用服务器

## 快速开始

### 本地开发

#### 环境要求

- Node.js 18+ / 20+
- Docker & Docker Compose
- Git

### 安装步骤

1. **克隆项目**
```bash
git clone <repository-url>
cd education-crm
```

2. **安装依赖**
```bash
npm run install:all
```

3. **启动数据库服务**

**方式 A：使用 Docker（推荐给熟悉 Docker 的用户）**
```bash
npm run docker:up
```

**方式 B：使用本地 MySQL（推荐给 Docker 有问题的用户）**
- 📖 详细安装指南：[`MYSQL_LOCAL_SETUP.md`](./MYSQL_LOCAL_SETUP.md)
- 🚀 快速启动：双击运行 `start-without-docker.bat`
- ✅ 优势：无需 Docker，性能更好，更稳定

4. **启动开发服务器**
```bash
# 同时启动前后端
npm run dev

# 或分别启动
npm run dev:frontend  # 前端：http://localhost:5174
npm run dev:backend   # 后端：http://localhost:3000
```

5. **访问系统**
- 前端：http://localhost:5174
- 后端 API 文档：http://localhost:3000/api
- 数据大屏：http://localhost:5174/datascreen
- 消息中心：http://localhost:5174/notification
- 操作日志：http://localhost:5174/system/operation-log
- 默认管理员账号：`admin` / `123456`
- 测试销售账号：`sales01` / `123456`、`sales02` / `123456`

#### Docker 命令

```bash
# 启动容器
npm run docker:up

# 停止容器
npm run docker:down

# 查看日志
npm run docker:logs
```

### 生产环境部署

本项目支持**Docker + GitHub Actions自动化部署**方案，实现一键部署和零停机更新。

#### 部署特性

- ✅ **容器化部署** - Docker编排，环境一致性保证
- ✅ **自动化CI/CD** - Git push触发自动构建和部署
- ✅ **零配置更新** - 代码提交后1-3分钟自动上线
- ✅ **服务健康检查** - 自动监控容器状态
- ✅ **数据持久化** - 数据库和上传文件自动备份

#### 快速部署

1. **准备服务器**（阿里云/腾讯云轻量服务器，2核4G，80-100元/月）

2. **安装Docker和Docker Compose**
   ```bash
   curl -fsSL https://get.docker.com | bash
   docker-compose --version
   ```

3. **克隆代码并配置**
   ```bash
   git clone <your-repo-url> /var/www/crm
   cd /var/www/crm
   cp .env.example .env
   nano .env  # 配置数据库密码和JWT密钥
   ```

4. **启动服务**
   ```bash
   docker-compose up -d --build
   ```

5. **配置GitHub Actions**
   - 在GitHub仓库设置中添加Secrets（服务器IP、SSH密钥等）
   - 详细步骤见 [DEPLOYMENT.md](./DEPLOYMENT.md)

6. **享受自动部署**
   ```bash
   git push origin master  # 推送后自动部署
   ```

#### 详细文档

📖 完整的生产环境部署指南请查看：[**DEPLOYMENT.md**](./DEPLOYMENT.md)

包含：
- 服务器选购和配置
- Docker环境搭建
- GitHub Actions配置
- 日常运维管理
- 常见问题解决

## 项目结构

```
education-crm/
├── frontend/           # Vue3 前端
├── backend/            # Nest.js 后端
├── database/           # 数据库脚本
├── docker/             # Docker 配置
├── docs/               # 项目文档
├── docker-compose.yml  # Docker 编排
├── package.json        # Monorepo 配置
└── README.md
```

## 功能模块说明

### 1. 客户管理（CRM）

**客户列表** (`/customer/list`)
- 支持按关键词搜索（微信昵称/微信号/手机号）
- 按客户意向筛选（高/中/低）
- 按流量来源筛选
- 分页展示，支持批量操作

**客户详情** (`/customer/detail/:id`)
- 三部分布局：基本信息 + 跟进记录 + 订单历史
- 时间线展示跟进记录
- 实时显示订单历史
- 支持编辑客户信息和添加跟进记录

### 2. 订单管理

**订单列表** (`/order/list`)
- 多维度搜索（订单号/微信号/手机号）
- 按订单状态、学员类型、支付时间筛选
- Excel批量导入/导出功能
- 智能客户匹配（自动关联已有客户）

**订单看板** (`/order/dashboard`)
- 4个核心指标卡片（总订单、总收入、新学员、老学员）
- 订单状态分布饼图
- 新老学员占比图
- 最近订单列表

### 3. 财务统计

**财务概览** (`/finance`)
- 总收入、订单总数、退款统计、平均客单价
- 收入趋势图（支持按日/按月切换）
- 销售排行榜（Top 10横向柱状图）
- 校区收入分布饼图
- 课程收入统计表格（Top 10）

### 4. 管理看板

**首页看板** (`/dashboard`)
- 今日实时数据（新增客户、新增订单、今日收入）
- 总体数据展示（客户总数、订单总数、总收入、本月收入）
- 近7天收入趋势折线图
- 客户意向分布
- 订单状态分布
- 新老学员占比

### 5. 数据大屏

**全屏展示** (`/datascreen`)
- 专为1920×1080分辨率设计
- 深色主题，适合大屏投影
- 实时时钟显示
- 30秒自动刷新数据
- 三栏布局展示核心业务数据
- 包含所有关键图表和统计

## 开发指南

详细开发文档请查看：
- [数据库设计文档](./docs/DATABASE.md)
- [快速开始指南（使用 Docker）](./SETUP_GUIDE.md)
- [**MySQL 本地安装指南（不使用 Docker）**](./MYSQL_LOCAL_SETUP.md) ⭐推荐
- [完整功能实现指南](./IMPLEMENTATION_GUIDE.md)

### 依赖安装

**后端额外依赖（文件上传功能）：**
```bash
cd backend
npm install @nestjs/platform-express multer
npm install @types/multer --save-dev
```

### 环境变量配置

```env
# 文件上传配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760  # 10MB
```

## 系统特性

### 用户规模
- 支持 10-50 人同时在线
- 客户数据：1-10 万级别
- 订单量：每月 2000+ 条

### 性能优化
- 数据库索引优化
- Redis 缓存热点数据
- 前端虚拟滚动长列表
- 分页查询（每页 20-50 条）

### 安全特性
- JWT Token 认证
- 基于角色的权限控制（RBAC）
- 数据权限隔离
- SQL 注入防护
- XSS 攻击防护
- 操作日志审计
- 敏感信息脱敏

## 角色权限

| 角色 | 权限说明 |
|------|---------|
| 超级管理员 | 查看和管理所有数据 |
| 校区主管 | 查看和管理本校区所有数据 |
| 销售主管 | 查看和管理本部门销售数据 |
| 销售 | 仅查看和管理自己的客户和订单 |
| 运营 | 查看流量数据，不能查看订单金额 |
| 财务 | 查看所有订单和财务报表 |

## 浏览器支持

- Chrome 90+（推荐）
- Edge 90+
- Firefox 88+
- Safari 14+

## 开发团队

Education CRM Team

## 许可证

MIT License

---

如有问题，请查看 [文档](./docs) 或提交 Issue。
