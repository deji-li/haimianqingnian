===============================================
  海绵青年CRM - 新功能部署说明
===============================================

【本次更新内容】
✓ AI营销助手（6种场景文案生成）
✓ AI人效分析看板（管理层使用）
✓ AI诊断报告（周报/月报/季报）
✓ CRM统计页面（销售个人数据）

【部署方式】
自动部署：推送代码到GitHub → 自动部署到服务器

===============================================
  快速部署（3步）
===============================================

方法1：使用脚本（推荐）
---------------------
双击运行：QUICK-DEPLOY.bat


方法2：手动执行
---------------------
在 D:\CC\1.1 目录下打开命令行，依次执行：

1. git add .

2. git commit -m "feat: 新增AI功能模块"

3. git push origin master


===============================================
  查看部署进度
===============================================

访问：https://github.com/deji-li/haimianqingnian/actions

预计时间：3-5分钟

===============================================
  部署完成后必做（重要！）
===============================================

1. SSH登录服务器
   ssh root@你的服务器IP

2. 进入项目目录
   cd /var/www/crm

3. 编辑环境变量
   vim .env

   添加以下3行（替换为你的实际API密钥）：
   DEEPSEEK_API_KEY=sk-你的API密钥
   DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
   DEEPSEEK_MODEL=deepseek-chat

4. 重启后端服务
   docker-compose restart backend

5. 检查服务状态
   docker-compose ps

   (应该看到3个容器都是Up状态)

===============================================
  获取DeepSeek API密钥
===============================================

1. 访问：https://platform.deepseek.com
2. 注册/登录账号
3. 进入 API Keys 页面
4. 点击"创建新密钥"
5. 复制密钥到.env文件

===============================================
  验证新功能
===============================================

登录系统后，检查以下菜单：

✓ AI智能助手 → AI营销助手
✓ AI智能助手 → AI人效分析
✓ AI智能助手 → AI诊断报告
✓ 侧边栏 → CRM统计

如果都能正常访问，说明部署成功！

===============================================
  常见问题
===============================================

Q: GitHub Actions部署失败？
A: 1. 检查GitHub Secrets配置是否正确
   2. 查看Actions日志中的错误信息
   3. 确认服务器磁盘空间充足

Q: 容器无法启动？
A: 执行：docker-compose logs backend
   查看详细错误日志

Q: AI功能报错？
A: 1. 确认DeepSeek API密钥已配置
   2. 检查密钥是否有效
   3. 重启后端容器

Q: 新页面404？
A: 清除浏览器缓存，按Ctrl+Shift+R强制刷新

===============================================
  回滚方案
===============================================

如果部署后出现问题，可以快速回滚：

ssh root@你的服务器IP
cd /var/www/crm
git log --oneline -5           # 查看最近5次提交
git reset --hard 上一个提交的hash  # 回滚
docker-compose down
docker-compose up -d --build    # 重新部署

===============================================
  技术支持
===============================================

遇到问题请查看：UPDATE-DEPLOYMENT.md

或查看Docker日志：
docker-compose logs -f

===============================================
