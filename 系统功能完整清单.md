# 海绵青年教育CRM系统 - 完整功能清单

**系统版本**: v2.0.0
**文档日期**: 2025-01-07
**技术栈**: NestJS + Vue 3 + TypeScript + MySQL + Redis
**AI能力**: DeepSeek + 豆包OCR

---

## 📊 系统概览

| 维度 | 数据 |
|------|------|
| 后端模块数 | 21个 |
| 前端页面数 | 33个 |
| API端点数 | 150+ |
| 数据库表数 | 29个 |
| AI功能模块 | 7大模块 |
| 用户角色数 | 5种角色 |

---

## 🎯 核心业务模块（15个）

### 1. 认证与授权模块 (Auth & User)

#### 1.1 认证模块 (Auth Module)
**路由**: `/api/auth`

**功能列表**:
- ✅ 用户登录 (POST /auth/login)
  - 账号密码验证
  - JWT Token生成
  - 登录日志记录
  - 设备信息记录
- ✅ 用户登出 (POST /auth/logout)
- ✅ Token刷新 (POST /auth/refresh)
- ✅ 密码修改 (POST /auth/change-password)
- ✅ 密码重置 (POST /auth/reset-password)
- ✅ 获取验证码 (GET /auth/captcha)

**安全特性**:
- JWT双Token机制（Access + Refresh）
- 密码bcrypt加密
- 登录失败次数限制
- IP白名单（可选）
- 设备指纹识别

---

#### 1.2 用户管理模块 (User Module)
**路由**: `/api/user`
**前端页面**: `/system/user`

**功能列表**:
- ✅ 用户列表查询 (GET /user)
  - 分页查询
  - 多条件筛选（姓名/手机/部门/角色/状态）
  - 支持排序
- ✅ 创建用户 (POST /user)
  - 基本信息（用户名/密码/真实姓名/手机/邮箱）
  - 角色分配
  - 部门分配
  - 校区分配
- ✅ 更新用户 (PUT /user/:id)
- ✅ 删除用户 (DELETE /user/:id)
- ✅ 批量删除 (DELETE /user/batch)
- ✅ 启用/禁用用户 (PATCH /user/:id/status)
- ✅ 重置密码 (POST /user/:id/reset-password)
- ✅ 获取用户详情 (GET /user/:id)
- ✅ 获取当前用户信息 (GET /user/profile)
- ✅ 更新个人资料 (PUT /user/profile)
- ✅ 修改个人密码 (PUT /user/profile/password)
- ✅ 上传头像 (POST /user/profile/avatar)
- ✅ 获取用户权限列表 (GET /user/permissions)
- ✅ 获取部门下的用户 (GET /user/department/:id)
- ✅ 获取校区下的用户 (GET /user/campus/:id)
- ✅ 获取销售人员列表 (GET /user/sales)

**数据字段**:
- id (主键)
- username (登录用户名, 唯一)
- password (密码, 加密存储)
- realName (真实姓名)
- phone (手机号)
- email (邮箱)
- avatar (头像URL)
- roleId (角色ID)
- departmentId (部门ID)
- campusId (校区ID)
- status (状态: 1启用 0禁用)
- lastLoginTime (最后登录时间)
- lastLoginIp (最后登录IP)
- createTime (创建时间)
- updateTime (更新时间)

---

### 2. 客户管理模块 (Customer Module)

**路由**: `/api/customer`
**前端页面**:
- `/customer/list` - 客户列表
- `/customer/detail/:id` - 客户详情
- `/customer/lifecycle-board` - 生命周期看板
- `/customer/follow` - 跟进管理

#### 2.1 客户基础功能

**功能列表**:
- ✅ 客户列表查询 (GET /customer)
  - 分页查询
  - 多维度筛选：
    - 微信昵称/ID/手机/真实姓名
    - 来源渠道
    - 意向等级（高/中/低）
    - 生命周期阶段（线索/客户/商机/成交/流失/复购）
    - 归属销售
    - 创建时间范围
  - 支持排序
  - 数据权限控制
- ✅ 创建客户 (POST /customer)
  - 智能防重（微信ID查重）
  - 自动分配销售（如未指定）
  - 自动设置生命周期阶段
- ✅ 更新客户 (PUT /customer/:id)
- ✅ 删除客户 (DELETE /customer/:id)
- ✅ 批量删除 (DELETE /customer/batch)
- ✅ 批量更新 (PATCH /customer/batch)
  - 批量修改销售归属
  - 批量修改意向等级
  - 批量修改生命周期
  - 批量添加标签
- ✅ 获取客户详情 (GET /customer/:id)
  - 基本信息
  - 跟进记录
  - 订单记录
  - AI分析记录
  - 客户标签
- ✅ 客户分配 (POST /customer/assign)
  - 单个分配
  - 批量分配
  - 分配日志记录
- ✅ 客户转移 (POST /customer/transfer)
  - 销售离职转移
  - 跨部门转移
  - 转移记录保留
- ✅ 客户回收 (POST /customer/recycle)
  - 长期未跟进自动回收
  - 手动回收
  - 回收至客户公海
- ✅ 客户公海 (GET /customer/pool)
  - 公海客户列表
  - 领取客户
  - 公海规则配置
- ✅ 客户导入 (POST /customer/import)
  - Excel批量导入
  - 数据验证
  - 重复检测
  - 导入日志
- ✅ 客户导出 (GET /customer/export)
  - 支持Excel导出
  - 按筛选条件导出
  - 导出数据脱敏

#### 2.2 客户跟进功能

**功能列表**:
- ✅ 创建跟进记录 (POST /customer/:id/follow)
  - 跟进方式（电话/微信/面谈/其他）
  - 跟进内容
  - 客户反馈
  - 下次跟进时间
  - 附件上传
- ✅ 获取跟进记录列表 (GET /customer/:id/follow-records)
- ✅ 更新跟进记录 (PUT /customer/follow-record/:id)
- ✅ 删除跟进记录 (DELETE /customer/follow-record/:id)
- ✅ 待跟进客户列表 (GET /customer/pending-followups)
  - 今日待跟进
  - 逾期未跟进
  - 按优先级排序
- ✅ 跟进提醒 (GET /customer/follow-reminders)
  - 今日提醒
  - 明日提醒
  - 本周提醒
- ✅ 跟进统计 (GET /customer/follow-stats)
  - 今日跟进数
  - 本周跟进数
  - 本月跟进数
  - 跟进完成率

#### 2.3 客户生命周期管理

**生命周期阶段**:
1. **线索** - 初步接触，信息不完整
2. **客户** - 信息完整，有明确联系方式
3. **商机** - 有明确购买意向
4. **成交客户** - 已签约付款
5. **流失客户** - 长期未互动
6. **复购客户** - 二次及以上购买

**功能列表**:
- ✅ 生命周期看板 (GET /customer/lifecycle-board)
  - 各阶段客户数量
  - 阶段转化率
  - 阶段停留时长
  - 漏斗图可视化
- ✅ 生命周期推进 (POST /customer/:id/advance-lifecycle)
  - 手动推进
  - 自动推进（基于规则）
  - 推进日志
- ✅ 生命周期回退 (POST /customer/:id/regress-lifecycle)
- ✅ 生命周期统计 (GET /customer/lifecycle-stats)
  - 各阶段分布
  - 转化趋势
  - 平均停留时间

#### 2.4 客户数据分析

**功能列表**:
- ✅ 客户来源分析 (GET /customer/source-analysis)
  - 各渠道客户数
  - 渠道质量评估
  - 渠道ROI分析
- ✅ 客户意向分布 (GET /customer/intent-distribution)
- ✅ 客户区域分布 (GET /customer/region-distribution)
- ✅ 客户年龄分布 (GET /customer/age-distribution)
- ✅ 新增客户趋势 (GET /customer/new-trend)
  - 日/周/月新增趋势
  - 同比环比分析
- ✅ 流失客户分析 (GET /customer/churn-analysis)
  - 流失原因分析
  - 流失趋势
  - 高危客户识别

**数据字段**:
- id (主键)
- wechatId (微信号, 唯一)
- wechatNickname (微信昵称)
- phone (手机号)
- realName (真实姓名)
- trafficSource (来源渠道)
- salesId (归属销售ID)
- customerIntent (意向等级)
- lifecycleStage (生命周期阶段)
- tags (客户标签, JSON)
- remark (备注)
- nextFollowTime (下次跟进时间)
- lastFollowTime (最后跟进时间)
- createTime (创建时间)
- updateTime (更新时间)

---

### 3. 订单管理模块 (Order Module)

**路由**: `/api/order`
**前端页面**:
- `/order/list` - 订单列表
- `/order/dashboard` - 订单看板

#### 3.1 订单基础功能

**功能列表**:
- ✅ 订单列表查询 (GET /order)
  - 分页查询
  - 多维度筛选：
    - 订单编号
    - 客户信息
    - 课程名称
    - 订单状态（待支付/已支付/已取消/已退款）
    - 销售人员
    - 创建时间范围
    - 支付时间范围
  - 支持排序
  - 数据权限控制
- ✅ 创建订单 (POST /order)
  - 智能关联客户
    - 通过客户ID
    - 通过手机号自动匹配
    - 通过微信号自动匹配
  - 自动计算金额
  - 自动生成订单编号
  - 支持多课程
  - 支持优惠券
- ✅ 更新订单 (PUT /order/:id)
- ✅ 删除订单 (DELETE /order/:id)
- ✅ 获取订单详情 (GET /order/:id)
  - 订单基本信息
  - 客户信息
  - 课程信息
  - 支付信息
  - 提成信息
  - 操作日志
- ✅ 订单支付确认 (POST /order/:id/pay)
  - 更新订单状态
  - 记录支付信息
  - **自动计算销售提成**
  - **自动创建运营提成**
  - 更新客户生命周期
- ✅ 订单取消 (POST /order/:id/cancel)
  - 取消原因记录
  - 回滚提成
  - 更新库存（如有）
- ✅ 订单退款 (POST /order/:id/refund)
  - 退款金额
  - 退款原因
  - 提成回滚
  - 退款日志
- ✅ 订单导出 (GET /order/export)

#### 3.2 订单统计分析

**功能列表**:
- ✅ 订单看板 (GET /order/dashboard)
  - 今日订单数/金额
  - 本周订单数/金额
  - 本月订单数/金额
  - 同比环比分析
- ✅ 订单趋势分析 (GET /order/trend)
  - 日/周/月趋势
  - 订单数趋势
  - 订单金额趋势
- ✅ 订单来源分析 (GET /order/source-analysis)
- ✅ 课程销售排行 (GET /order/course-ranking)
- ✅ 销售排行榜 (GET /order/sales-ranking)
  - 按订单数排名
  - 按订单金额排名
  - 按转化率排名
- ✅ 订单转化漏斗 (GET /order/conversion-funnel)
  - 线索→客户→商机→成交
  - 各阶段转化率

**数据字段**:
- id (主键)
- orderNumber (订单编号, 唯一)
- customerId (客户ID)
- salesId (销售人员ID)
- courseName (课程名称)
- courseType (课程类型)
- totalAmount (订单总金额)
- discountAmount (优惠金额)
- paymentAmount (实付金额)
- paymentMethod (支付方式)
- paymentTime (支付时间)
- orderStatus (订单状态)
- isNewStudent (是否新学员)
- operatorId (运营人员ID)
- orderTags (订单标签, JSON)
- remark (备注)
- createTime (创建时间)
- updateTime (更新时间)

---

### 4. 提成管理模块 (Commission Module)

**路由**: `/api/commission`
**前端页面**: `/commission/list`

#### 4.1 提成规则配置

**功能列表**:
- ✅ 提成规则列表 (GET /commission/rules)
- ✅ 创建提成规则 (POST /commission/rules)
  - 按课程类型配置
  - 按订单金额配置
  - 阶梯提成
  - 固定提成
  - 百分比提成
- ✅ 更新提成规则 (PUT /commission/rules/:id)
- ✅ 删除提成规则 (DELETE /commission/rules/:id)
- ✅ 启用/禁用规则 (PATCH /commission/rules/:id/status)

#### 4.2 提成计算与发放

**功能列表**:
- ✅ 提成自动计算 (POST /commission/calculate/:orderId)
  - 订单支付时自动触发
  - 根据规则自动计算
  - 支持多规则匹配
  - 记录计算日志
- ✅ 提成列表查询 (GET /commission)
  - 分页查询
  - 按销售筛选
  - 按时间筛选
  - 按状态筛选（待发放/已发放/已取消）
- ✅ 提成详情 (GET /commission/:id)
- ✅ 批量发放提成 (POST /commission/batch-issue)
  - 批量确认发放
  - 发放日志
  - 财务对账
- ✅ 提成取消 (POST /commission/:id/cancel)
  - 订单退款时自动取消
  - 手动取消
  - 取消原因记录
- ✅ 提成统计 (GET /commission/stats)
  - 个人提成统计
  - 部门提成统计
  - 月度提成汇总
  - 提成发放率

**数据字段**:
- id (主键)
- orderId (订单ID)
- salesId (销售人员ID)
- commissionAmount (提成金额)
- commissionRate (提成比例)
- ruleId (适用规则ID)
- status (状态: 待发放/已发放/已取消)
- issueTime (发放时间)
- remark (备注)
- createTime (创建时间)

---

### 5. 运营提成模块 (Operation Commission Module)

**路由**: `/api/operation-commission`
**前端页面**: `/operation/commission`

**功能列表**:
- ✅ 运营提成列表 (GET /operation-commission)
- ✅ 自动创建运营提成
  - 新学员订单触发
  - 按订单标签匹配规则
  - 自动分配给运营人员
- ✅ 运营提成规则配置
  - 按订单标签配置
  - 按订单金额配置
  - 固定金额提成
  - 百分比提成
- ✅ 批量发放运营提成 (POST /operation-commission/batch-issue)
- ✅ 运营提成统计 (GET /operation-commission/stats)

**数据字段**:
- id (主键)
- orderId (订单ID)
- operatorId (运营人员ID)
- commissionAmount (提成金额)
- orderTag (订单标签)
- status (状态)
- issueTime (发放时间)
- createTime (创建时间)

---

### 6. 财务管理模块 (Finance Module)

**路由**: `/api/finance`
**前端页面**: `/finance/overview`

#### 6.1 财务概览

**功能列表**:
- ✅ 财务概览看板 (GET /finance/overview)
  - 今日收入/支出
  - 本周收入/支出
  - 本月收入/支出
  - 本年收入/支出
  - 利润统计
- ✅ 收入趋势分析 (GET /finance/revenue-trend)
  - 日/周/月/年趋势
  - 同比环比分析
  - 收入预测
- ✅ 支出分析 (GET /finance/expense-analysis)
  - 支出类别分布
  - 支出趋势
  - 成本占比
- ✅ 利润分析 (GET /finance/profit-analysis)
  - 毛利率
  - 净利率
  - 利润趋势

#### 6.2 财务报表

**功能列表**:
- ✅ 收支明细表 (GET /finance/transaction-details)
  - 收入明细
  - 支出明细
  - 按时间筛选
  - 按类别筛选
- ✅ 提成汇总表 (GET /finance/commission-summary)
  - 销售提成汇总
  - 运营提成汇总
  - 待发放统计
  - 已发放统计
- ✅ 月度财务报表 (GET /finance/monthly-report)
- ✅ 年度财务报表 (GET /finance/yearly-report)
- ✅ 财务报表导出 (GET /finance/export)

---

### 7. 工作台模块 (Dashboard/Workspace Module)

**路由**: `/api/dashboard`, `/api/workspace`
**前端页面**:
- `/dashboard` - 数据看板（管理层）
- `/workspace` - 工作台（销售人员）

#### 7.1 管理看板 (Dashboard)

**功能列表**:
- ✅ 综合数据概览 (GET /dashboard/overview)
  - 客户总数
  - 今日新增客户
  - 订单总数
  - 今日订单数
  - 订单总金额
  - 今日订单金额
  - 销售人员数
  - 活跃销售人员数
- ✅ 实时业绩排行 (GET /dashboard/sales-ranking)
  - 本日排行
  - 本周排行
  - 本月排行
- ✅ 转化漏斗 (GET /dashboard/conversion-funnel)
- ✅ 趋势图表 (GET /dashboard/trends)
  - 客户增长趋势
  - 订单增长趋势
  - 收入增长趋势
- ✅ 预警通知 (GET /dashboard/alerts)
  - 高危客户预警
  - 订单异常预警
  - 业绩预警

#### 7.2 个人工作台 (Workspace)

**功能列表**:
- ✅ 个人数据概览 (GET /workspace/my-stats)
  - 我的客户数
  - 今日新增客户
  - 我的订单数
  - 今日订单数
  - 订单总金额
  - 今日订单金额
  - 本月提成
  - 待发放提成
- ✅ 今日待办 (GET /workspace/todo-today)
  - 今日待跟进客户
  - 今日回访客户
  - 待处理工单
  - 待办任务
- ✅ 近期跟进计划 (GET /workspace/follow-plan)
  - 今日计划
  - 明日计划
  - 本周计划
- ✅ 我的客户动态 (GET /workspace/customer-activities)
  - 最近互动
  - 生命周期变更
  - 意向变化
- ✅ 快捷操作入口
  - 新增客户
  - 创建订单
  - 添加跟进
  - AI工具

---

### 8. 团队管理模块 (Team Management Module)

**路由**: `/api/team`
**前端页面**: `/team/leaderboard`

#### 8.1 团队排行榜

**功能列表**:
- ✅ 团队业绩排行 (GET /team/performance-ranking)
  - 按订单数排名
  - 按订单金额排名
  - 按客户数排名
  - 按转化率排名
  - 支持时间筛选（日/周/月/季/年）
  - 支持部门筛选
  - 支持校区筛选
- ✅ 团队统计数据 (GET /team/stats)
  - 团队总业绩
  - 人均业绩
  - 团队目标完成率
  - 团队活跃度

#### 8.2 团队协作

**功能列表**:
- ✅ 团队成员列表 (GET /team/members)
- ✅ 成员业绩详情 (GET /team/member/:id/performance)
- ✅ 团队任务分配 (POST /team/tasks/assign)
- ✅ 团队公告 (GET /team/announcements)
- ✅ 团队知识分享 (GET /team/knowledge-sharing)

---

### 9. 目标管理模块 (Target Management Module)

**路由**: `/api/target`
**前端页面**: `/target/management`

#### 9.1 目标设置

**功能列表**:
- ✅ 目标列表查询 (GET /target)
  - 按类型筛选（个人/团队/部门/公司）
  - 按周期筛选（月/季/年）
  - 按状态筛选（进行中/已完成/已逾期）
- ✅ 创建目标 (POST /target)
  - 目标类型（订单数/订单金额/客户数/转化率）
  - 目标周期（月度/季度/年度）
  - 目标值
  - 分配对象（个人/团队/部门）
- ✅ 更新目标 (PUT /target/:id)
- ✅ 删除目标 (DELETE /target/:id)
- ✅ 批量设置目标 (POST /target/batch)

#### 9.2 目标跟踪

**功能列表**:
- ✅ 目标完成进度 (GET /target/:id/progress)
  - 实时完成值
  - 完成百分比
  - 预计完成时间
  - 达成趋势
- ✅ 目标完成统计 (GET /target/completion-stats)
  - 个人目标完成率
  - 团队目标完成率
  - 部门目标完成率
- ✅ 目标预警 (GET /target/alerts)
  - 逾期预警
  - 进度落后预警
  - 完成困难预警
- ✅ 目标调整记录 (GET /target/:id/adjustment-history)

**数据字段**:
- id (主键)
- targetName (目标名称)
- targetType (目标类型)
- targetPeriod (目标周期)
- targetValue (目标值)
- actualValue (实际完成值)
- targetUserId (目标负责人ID)
- departmentId (部门ID)
- startDate (开始日期)
- endDate (结束日期)
- status (状态)
- createTime (创建时间)

---

### 10. OKR管理模块 (OKR Module)

**路由**: `/api/okr`
**前端页面**: `/okr/list`

#### 10.1 OKR设置

**功能列表**:
- ✅ OKR列表查询 (GET /okr)
  - 按周期筛选（季度/年度）
  - 按负责人筛选
  - 按部门筛选
- ✅ 创建OKR (POST /okr)
  - Objective（目标）设定
  - Key Results（关键结果）设定（1-5个）
  - 负责人分配
  - 截止时间
- ✅ 更新OKR (PUT /okr/:id)
- ✅ 删除OKR (DELETE /okr/:id)
- ✅ 添加关键结果 (POST /okr/:id/key-results)
- ✅ 更新关键结果进度 (PUT /okr/key-result/:id)

#### 10.2 OKR跟踪

**功能列表**:
- ✅ OKR完成进度 (GET /okr/:id/progress)
  - Objective完成度
  - 各Key Result完成度
  - 整体进度
- ✅ OKR周期回顾 (GET /okr/period-review)
- ✅ OKR评分 (POST /okr/:id/score)
- ✅ OKR复盘 (POST /okr/:id/review)

**数据字段**:
- id (主键)
- objective (目标O)
- period (周期)
- ownerId (负责人ID)
- departmentId (部门ID)
- status (状态)
- score (评分)
- startDate (开始日期)
- endDate (结束日期)
- keyResults (关键结果列表, JSON)
  - kr (关键结果描述)
  - targetValue (目标值)
  - actualValue (实际值)
  - progress (进度百分比)
- createTime (创建时间)

---

### 11. 数据分析模块 (Analytics Module)

**路由**: `/api/analytics`
**前端页面**: `/analytics/*`

#### 11.1 销售漏斗分析

**功能列表**:
- ✅ 销售漏斗数据 (GET /analytics/sales-funnel)
  - 各阶段客户数量
  - 各阶段转化率
  - 漏斗图可视化
  - 支持时间筛选
  - 支持部门筛选

#### 11.2 客户来源分析

**功能列表**:
- ✅ 来源渠道统计 (GET /analytics/customer-source)
  - 各渠道客户数
  - 各渠道转化率
  - 各渠道订单金额
  - ROI分析

#### 11.3 销售周期分析

**功能列表**:
- ✅ 平均销售周期 (GET /analytics/sales-cycle)
  - 各阶段平均停留时间
  - 总体销售周期
  - 按产品分析
  - 按销售分析

#### 11.4 高价值客户分析

**功能列表**:
- ✅ 高价值客户识别 (GET /analytics/high-value-customers)
  - 按消费金额排名（Top 20）
  - 客户终身价值(LTV)
  - 复购率
  - 客单价

#### 11.5 转化趋势分析

**功能列表**:
- ✅ 12个月转化趋势 (GET /analytics/conversion-trend)
  - 月度转化率
  - 趋势变化
  - 同比环比

#### 11.6 收入预测

**功能列表**:
- ✅ 未来3个月收入预测 (GET /analytics/revenue-forecast)
  - 基于历史数据
  - 考虑季节性因素
  - 预测区间

#### 11.7 多维转化分析

**功能列表**:
- ✅ 多维度转化分析 (GET /analytics/conversion-analysis)
  - 按来源渠道分析
  - 按销售人员分析
  - 按校区分析
  - 交叉分析

---

### 12. 系统管理模块 (System Module)

**路由**: `/api/system`
**前端页面**: `/system/*`

#### 12.1 角色权限管理

**功能列表**:
- ✅ 角色列表 (GET /system/roles)
- ✅ 创建角色 (POST /system/roles)
- ✅ 更新角色 (PUT /system/roles/:id)
- ✅ 删除角色 (DELETE /system/roles/:id)
- ✅ 角色权限配置 (PUT /system/roles/:id/permissions)
- ✅ 获取角色权限 (GET /system/roles/:id/permissions)

**预设角色**:
- 超级管理员 (id: 1)
- 销售主管 (id: 2)
- 销售人员 (id: 3)
- 财务人员 (id: 4)
- 教务人员 (id: 5)

#### 12.2 权限管理

**功能列表**:
- ✅ 权限列表 (GET /system/permissions)
- ✅ 权限树 (GET /system/permissions/tree)
- ✅ 创建权限 (POST /system/permissions)
- ✅ 更新权限 (PUT /system/permissions/:id)
- ✅ 删除权限 (DELETE /system/permissions/:id)

**权限类型**:
- 菜单权限（menu）
- 按钮权限（button）
- API权限（api）
- 数据权限（data）

#### 12.3 部门管理

**功能列表**:
- ✅ 部门列表 (GET /system/departments)
- ✅ 部门树 (GET /system/departments/tree)
- ✅ 创建部门 (POST /system/departments)
- ✅ 更新部门 (PUT /system/departments/:id)
- ✅ 删除部门 (DELETE /system/departments/:id)
- ✅ 部门人员列表 (GET /system/departments/:id/users)

#### 12.4 校区管理

**功能列表**:
- ✅ 校区列表 (GET /system/campuses)
- ✅ 创建校区 (POST /system/campuses)
- ✅ 更新校区 (PUT /system/campuses/:id)
- ✅ 删除校区 (DELETE /system/campuses/:id)
- ✅ 校区人员列表 (GET /system/campuses/:id/users)

#### 12.5 字典管理

**功能列表**:
- ✅ 字典类型列表 (GET /system/dict/types)
- ✅ 字典数据列表 (GET /system/dict/data)
- ✅ 根据类型获取字典 (GET /system/dict/type/:type)
- ✅ 创建字典类型 (POST /system/dict/types)
- ✅ 创建字典数据 (POST /system/dict/data)
- ✅ 更新字典 (PUT /system/dict/:id)
- ✅ 删除字典 (DELETE /system/dict/:id)

**预设字典**:
- 客户来源（traffic_source）
- 客户意向（customer_intent）
- 生命周期（lifecycle_stage）
- 课程类型（course_type）
- 订单状态（order_status）
- 支付方式（payment_method）

---

### 13. 日志管理模块 (Log Module)

**路由**: `/api/log`
**前端页面**: `/system/operation-log`

#### 13.1 操作日志

**功能列表**:
- ✅ 操作日志列表 (GET /log/operation)
  - 分页查询
  - 按操作人筛选
  - 按操作类型筛选
  - 按模块筛选
  - 按时间范围筛选
- ✅ 操作日志详情 (GET /log/operation/:id)
- ✅ 操作日志统计 (GET /log/operation/stats)
  - 今日操作数
  - 本周操作数
  - 操作类型分布
  - 活跃用户统计

**记录内容**:
- 操作人
- 操作时间
- 操作类型（创建/更新/删除/查询）
- 操作模块
- 操作详情
- IP地址
- User-Agent
- 请求参数
- 响应结果

#### 13.2 登录日志

**功能列表**:
- ✅ 登录日志列表 (GET /log/login)
- ✅ 登录日志统计 (GET /log/login/stats)
  - 登录成功/失败统计
  - 活跃用户统计
  - IP地址分布

**记录内容**:
- 登录用户
- 登录时间
- 登录IP
- 登录设备
- 浏览器信息
- 登录状态（成功/失败）
- 失败原因

#### 13.3 系统日志

**功能列表**:
- ✅ 系统日志列表 (GET /log/system)
- ✅ 错误日志 (GET /log/errors)
- ✅ 日志清理 (DELETE /log/cleanup)
  - 按时间清理
  - 按日志级别清理

---

### 14. 通知管理模块 (Notification Module)

**路由**: `/api/notification`
**前端页面**: 顶部通知图标

#### 14.1 通知功能

**功能列表**:
- ✅ 获取通知列表 (GET /notification)
  - 分页查询
  - 按类型筛选
  - 按读取状态筛选
- ✅ 标记已读 (PUT /notification/:id/read)
- ✅ 批量标记已读 (PUT /notification/batch-read)
- ✅ 全部标记已读 (PUT /notification/read-all)
- ✅ 删除通知 (DELETE /notification/:id)
- ✅ 清空通知 (DELETE /notification/clear)
- ✅ 未读数量 (GET /notification/unread-count)

**通知类型**:
- 系统通知（system）
- 任务提醒（task）
- 审批通知（approval）
- 跟进提醒（follow）
- 订单通知（order）
- 目标预警（target）

#### 14.2 消息推送

**功能列表**:
- ✅ 站内信推送
- ✅ WebSocket实时推送
- ✅ 邮件通知（可选）
- ✅ 短信通知（可选）

---

### 15. 文件上传模块 (Upload Module)

**路由**: `/api/upload`

**功能列表**:
- ✅ 单文件上传 (POST /upload/single)
  - 图片上传
  - 文档上传
  - 自动压缩（图片）
  - 格式校验
  - 大小限制
- ✅ 多文件上传 (POST /upload/multiple)
- ✅ 分片上传 (POST /upload/chunk)
  - 大文件支持
  - 断点续传
- ✅ 文件删除 (DELETE /upload/:id)
- ✅ 获取文件列表 (GET /upload/list)
- ✅ 获取文件信息 (GET /upload/:id)

**支持格式**:
- 图片：jpg, jpeg, png, gif, webp
- 文档：pdf, doc, docx, xls, xlsx, ppt, pptx
- 压缩包：zip, rar
- 视频：mp4, avi, mov（可选）

**存储方式**:
- 本地存储（默认）
- OSS对象存储（可配置）
- CDN加速（可配置）

---

## 🤖 AI智能模块（7个）

### 1. AI聊天记录分析模块 (AI Chat Analysis)

**路由**: `/api/ai-chat`
**前端页面**: `/ai/chat-analysis`

#### 1.1 核心功能

**功能列表**:
- ✅ 上传聊天截图 (POST /ai-chat/upload)
  - 支持多图上传（最多9张）
  - 自动OCR识别（豆包OCR）
  - 智能AI分析（DeepSeek）
  - 异步处理（避免超时）
  - 分析结果缓存（2小时）
- ✅ 聊天记录列表 (GET /ai-chat/list)
  - 分页查询
  - 按客户筛选
  - 按质量等级筛选（A/B/C/D）
  - 按风险等级筛选
  - 按时间筛选
  - 数据权限控制
- ✅ 聊天详情 (GET /ai-chat/:id)
  - 完整分析结果
  - 识别的聊天文字
  - 客户画像
  - 跟进建议
- ✅ 删除记录 (DELETE /ai-chat/:id)
- ✅ 分析统计 (GET /ai-chat/statistics)
  - 总分析次数
  - 质量分布
  - 平均分析时长
  - 成功率统计

#### 1.2 AI分析维度（20+维度）

**1. 核心评估（4维度）**:
- **质量等级**：A（优质）/ B（良好）/ C（一般）/ D（差）
- **风险等级**：低 / 中 / 高
- **意向评分**：0-100分
- **沟通摘要**：一段式概述

**2. 客户画像（10维度）**:
- 家长角色（父亲/母亲/祖父母/其他）
- 学生年级（幼儿/小学/初中/高中/大学/成人）
- 家庭经济水平（高/中/低）
- 教育重视程度（非常重视/比较重视/一般/不重视）
- 决策者角色（主导/参与/协商/被动）
- 沟通风格（专业/友好/谨慎/挑剔）
- 时间灵活度（高/中/低）
- 地理位置信息
- 微信活跃度（高/中/低）

**3. 需求分析（5维度）**:
- 明确的需求点（数组）
- 痛点问题（数组）
- 兴趣点（数组）
- 提出的异议（数组）
- 提及的竞品（数组）

**4. 情绪态度（3维度）**:
- 客户心态（积极/中立/消极）
- 情绪基调（热情/平和/冷淡/焦虑）
- 信任程度（高/中/低）

**5. 成交评估（5维度）**:
- 预估客单价
- 预估成交周期
- 成交机会（大/中/小）
- 紧迫程度（高/中/低）
- 竞争激烈度（高/中/低）

**6. 销售策略**:
- 下一步行动建议
- 应对策略
- 推荐话术场景（4种场景）
  - 开场白
  - 需求挖掘
  - 应对异议
  - 促成成交

**7. 风险预警**:
- 风险因素（数组）
- 风险原因说明

#### 1.3 自动化触发

**触发动作**:
- ✅ 自动生成6类客户标签
  - 基础信息标签
  - 行为特征标签
  - 需求痛点标签
  - 质量评估标签
  - 风险标签
  - 情绪态度标签
- ✅ 自动更新客户意向等级
  - 根据意向评分自动调整
- ✅ 自动创建风险预警
  - 高风险客户自动创建预警记录
  - 推送至AI工具中心

**数据字段**:
- id (主键)
- customerId (客户ID)
- uploadUserId (上传人ID)
- images (截图路径, JSON数组)
- recognizedText (识别文字)
- analysisResult (完整分析结果, JSON)
- qualityLevel (质量等级)
- riskLevel (风险等级)
- intentScore (意向评分)
- status (状态: 分析中/已完成/失败)
- createTime (创建时间)

---

### 2. AI知识库模块 (AI Knowledge Base)

**路由**: `/api/ai-knowledge`
**前端页面**: `/ai/knowledge`

#### 2.1 核心功能

**功能列表**:
- ✅ 知识库列表 (GET /ai-knowledge/list)
  - 分页查询
  - 按分类筛选
  - 按关键词筛选
  - 按创建人筛选
  - 按使用次数排序
- ✅ 创建知识条目 (POST /ai-knowledge)
  - 标题
  - 分类
  - 内容（富文本）
  - 标签
  - 附件
- ✅ 更新知识 (PUT /ai-knowledge/:id)
- ✅ 删除知识 (DELETE /ai-knowledge/:id)
- ✅ 获取知识详情 (GET /ai-knowledge/:id)
  - 自动增加使用次数
  - 记录访问日志
- ✅ 智能搜索 (POST /ai-knowledge/search)
  - **AI语义匹配**（DeepSeek）
  - 关键词提取
  - 多关键词OR匹配
  - 相关性评分
  - 智能排序
- ✅ 批量导入 (POST /ai-knowledge/batch-import)
  - Excel批量导入
  - 数据验证
  - 自动分类
- ✅ 获取分类列表 (GET /ai-knowledge/categories)
  - 各分类数量统计

#### 2.2 知识分类

**预设分类**:
- 产品知识
- 政策法规
- 销售话术
- 成功案例
- 常见问题FAQ
- 培训资料
- 行业资讯
- 竞品分析

#### 2.3 AI增强功能

**功能特性**:
- ✅ **智能语义搜索**
  - 理解用户意图
  - 相似问题匹配
  - 智能推荐相关知识
- ✅ **关键词自动提取**
  - 中文分词
  - 关键词权重计算
  - 自动打标签
- ✅ **相关性评分**
  - AI计算匹配度
  - 按相关性排序
  - Top N推荐

**数据字段**:
- id (主键)
- title (标题)
- category (分类)
- content (内容, 富文本)
- keywords (关键词, 数组)
- attachments (附件, JSON)
- creatorId (创建人ID)
- usageCount (使用次数)
- isActive (是否启用)
- createTime (创建时间)
- updateTime (更新时间)

---

### 3. AI客户标签模块 (AI Customer Tags)

**路由**: `/api/ai-tags`
**前端页面**: 客户详情页标签区域

#### 3.1 核心功能

**功能列表**:
- ✅ 获取客户标签 (GET /ai-tags/customer/:customerId)
  - 按分类分组显示
  - 显示AI/手动来源
  - 显示创建时间
- ✅ 手动添加标签 (POST /ai-tags)
  - 选择分类
  - 输入标签名
  - 选择客户
- ✅ 删除标签 (DELETE /ai-tags/:id)
- ✅ 标签列表 (GET /ai-tags/list)
  - 按客户筛选
  - 按分类筛选
  - 按来源筛选
- ✅ 标签统计 (GET /ai-tags/statistics)
  - AI标签数量
  - 手动标签数量
  - 各分类标签分布
  - 标签使用频率

#### 3.2 AI自动打标签

**触发时机**:
- AI聊天分析完成后自动打标签

**标签分类（6类）**:

**1. 基础信息类**:
- 家长角色：父亲、母亲、祖父母、其他
- 学生年级：幼儿、小学1-6、初中1-3、高中1-3、大学、成人
- 地理位置：城市、区域
- 经济水平：高、中、低

**2. 行为特征类**:
- 教育态度：非常重视、比较重视、一般、不重视
- 决策角色：主导决策、参与决策、协商决策、被动接受
- 沟通风格：专业型、友好型、谨慎型、挑剔型、其他
- 时间灵活度：高、中、低

**3. 需求痛点类**:
- 具体需求：成绩提升、习惯养成、兴趣培养、升学规划、竞赛辅导、其他
- 痛点问题：学习效率低、基础薄弱、偏科严重、注意力不集中、作业拖延、其他
- 兴趣点：教学质量、师资力量、价格优惠、学习环境、课程体系、其他

**4. 质量评估类**:
- 质量等级：A级客户、B级客户、C级客户、D级客户
- 意向等级：高意向、中意向、低意向
- 成交机会：成交机会大、成交机会中、成交机会小

**5. 风险类**:
- 风险等级：高风险、中风险、低风险
- 提及竞品：竞品A、竞品B、竞品C
- 价格敏感：价格敏感

**6. 情绪态度类**:
- 客户心态：积极主动、中立观望、消极抗拒
- 情绪基调：热情、平和、冷淡、焦虑
- 信任程度：信任度高、信任度中、信任度低

**数据字段**:
- id (主键)
- customerId (客户ID)
- tagCategory (标签分类)
- tagName (标签名称)
- source (来源: AI / 手动)
- createdBy (创建人ID)
- fromChatRecordId (来源聊天记录ID)
- createTime (创建时间)

---

### 4. AI工具中心模块 (AI Tools Module)

**路由**: `/api/ai-tools`
**前端页面**: `/ai/tools`

这是一个集成模块，包含4个子工具：

#### 4.1 AI话术助手 (Script Assistant)

**功能列表**:
- ✅ 生成个性化话术 (POST /ai-tools/script/generate)
  - 输入：客户ID、话术类型
  - 读取客户画像和历史记录
  - AI生成个性化话术（DeepSeek）
  - 支持5种场景：
    - **开场白**：初次联系话术
    - **需求挖掘**：深入了解需求
    - **应对异议**：处理客户疑虑
    - **促成成交**：推动签单话术
    - **售后跟进**：成交后维护
- ✅ 话术库列表 (GET /ai-tools/script/list)
  - 按类型筛选
  - 按效果评分排序
  - 显示使用次数
- ✅ 记录话术使用 (POST /ai-tools/script/:id/use)
  - 增加使用次数
  - 记录使用场景
- ✅ 标记话术有效 (POST /ai-tools/script/:id/mark-success)
  - 增加成功次数
  - 提升效果评分

**话术生成逻辑**:
```
1. 读取客户基本信息（姓名、年级等）
2. 读取客户标签（需求、痛点、兴趣）
3. 读取历史沟通记录
4. 构建AI提示词
5. 调用DeepSeek生成话术
6. 返回个性化话术
7. 保存至话术库
```

#### 4.2 AI风险预警 (Risk Alerts)

**功能列表**:
- ✅ 获取待处理风险 (GET /ai-tools/risk/pending)
  - 按风险等级排序
  - 显示风险原因
  - 显示建议行动
  - 数据权限控制
- ✅ 处理风险预警 (POST /ai-tools/risk/:id/handle)
  - 记录处理措施
  - 更新处理状态
  - 记录处理结果
- ✅ 风险统计 (GET /ai-tools/risk/stats)
  - 待处理风险数
  - 已处理风险数
  - 按风险类型统计
  - 按风险等级统计

**风险类型**:
- 流失风险：长期未互动、意向下降、竞品提及
- 成交风险：价格敏感、决策困难、信任度低
- 跟进风险：逾期未跟进、跟进频率低
- 质量风险：沟通质量差、需求不明确

**自动创建规则**:
- AI聊天分析检测到高风险时自动创建
- 系统检测到长期未跟进时自动创建
- 客户意向下降时自动创建

#### 4.3 AI客户复苏 (Customer Recovery)

**功能列表**:
- ✅ 识别沉睡客户 (GET /ai-tools/recovery/sleeping-customers)
  - 参数：沉睡天数（默认30天）
  - 筛选：最后跟进时间超过N天
  - 筛选：有一定意向等级
  - 筛选：未成交客户
  - 返回：客户列表 + AI复苏话术
- ✅ AI生成唤醒话术
  - 读取客户历史记录
  - 分析沉睡原因
  - 生成唤醒话术
  - 提供行动建议

**复苏话术生成逻辑**:
```
1. 分析客户历史沟通记录
2. 识别客户关注点和痛点
3. 找出沉睡原因（价格/时间/犹豫/竞品）
4. 生成针对性唤醒话术
5. 提供激活优惠建议
```

#### 4.4 AI培训陪练 (Training Practice)

**功能列表**:
- ✅ 开始陪练 (POST /ai-tools/training/start)
  - 选择训练场景：
    - 首次接触客户
    - 需求挖掘
    - 价格谈判
    - 处理异议
    - 促成签单
  - AI扮演客户角色
  - 生成客户背景
- ✅ 对话练习 (POST /ai-tools/training/:id/chat)
  - 销售发送消息
  - AI客户实时回复
  - 模拟真实场景
  - 记录对话过程
- ✅ 结束陪练 (POST /ai-tools/training/:id/end)
  - 自动评分（0-100分）
  - 多维度评价：
    - **沟通技巧**（0-100分）
    - **响应速度**（0-100分）
    - **异议处理**（0-100分）
  - AI反馈建议
  - 训练结果评级（优秀/良好/及格/不及格）
- ✅ 训练记录列表 (GET /ai-tools/training/records)
- ✅ 训练统计 (GET /ai-tools/training/stats)
  - 总训练次数
  - 平均得分
  - 各场景练习次数

**评分维度**:
- 沟通技巧：礼貌性、专业性、共情能力
- 响应速度：回复及时性、回复完整性
- 异议处理：应对策略、说服力、灵活性

**数据表**:
- `ai_scripts` - 话术库表
- `ai_risk_alerts` - 风险预警表
- `ai_training_records` - 培训记录表

---

### 5. AI营销助手模块 (AI Marketing Assistant) 🆕

**路由**: `/api/ai-tools/marketing`
**前端页面**: `/ai/marketing`

#### 5.1 核心功能

**功能列表**:
- ✅ 生成营销文案 (POST /ai-tools/marketing/generate)
  - 6种内容类型
  - 客户画像输入
  - 产品信息输入
  - 痛点需求选择
  - AI生成文案
- ✅ 营销文案历史 (GET /ai-tools/marketing/history)
  - 按类型筛选
  - 按时间筛选
  - 查看历史文案

#### 5.2 支持的6种内容类型

**1. 朋友圈文案**
- 适用场景：微信朋友圈营销
- 特点：简短精练、吸引眼球、带emoji
- 字数：100-200字
- 包含：痛点共鸣 + 解决方案 + 行动召唤

**2. 微信群发文案**
- 适用场景：微信私聊群发
- 特点：个性化称呼、亲切自然
- 字数：150-300字
- 包含：问候 + 痛点 + 方案 + 优惠 + CTA

**3. 抖音营销文案**
- 适用场景：抖音短视频文案
- 特点：节奏感强、口语化、热点结合
- 字数：50-100字
- 包含：hook开场 + 痛点放大 + 解决方案 + 评论引导

**4. 小红书营销文案**
- 适用场景：小红书图文笔记
- 特点：真诚分享、场景化、标签丰富
- 字数：300-500字
- 包含：标题 + 场景故事 + 产品体验 + 推荐理由 + 标签

**5. 短视频拍摄脚本**
- 适用场景：短视频拍摄指导
- 特点：分镜详细、画面描述清晰
- 结构：开场（3-5秒）+ 正文（30秒）+ 结尾（5秒）
- 包含：画面 + 文案 + 背景音乐建议

**6. 公众号推文**
- 适用场景：微信公众号文章
- 特点：结构完整、深度内容
- 字数：800-1500字
- 包含：标题 + 开场 + 正文（3-5个要点）+ 总结 + CTA

#### 5.3 文案生成流程

```
用户输入：
├─ 内容类型（6选1）
├─ 目标客户（年龄、角色、特征）
├─ 产品信息（名称、特点）
├─ 痛点需求（多选）
└─ 兴趣点（多选）

AI处理：
├─ 分析目标人群特征
├─ 匹配痛点和需求
├─ 选择合适的沟通风格
├─ 融入产品卖点
└─ 生成符合平台调性的文案

输出结果：
├─ 完整文案
├─ 配图建议（如适用）
├─ 发布建议（最佳时间、标签等）
└─ 可复制/重新生成/保存
```

**数据字段**:
- id (主键)
- contentType (内容类型)
- customerProfile (客户画像, JSON)
- productInfo (产品信息, JSON)
- generatedContent (生成的文案)
- creatorId (创建人ID)
- createTime (创建时间)

---

### 6. AI人效分析模块 (AI Efficiency Analytics) 🆕

**路由**: `/api/ai-tools/analytics`
**前端页面**: `/ai/analytics`

#### 6.1 核心功能

**功能列表**:
- ✅ 获取人效分析数据 (GET /api/ai-tools/analytics/efficiency)
  - 参数：起止日期、用户ID、部门ID
  - 返回：5类分析数据
  - 权限控制：管理层可见

#### 6.2 分析维度（5类）

**1. 销售人员AI使用排行**
- 数据项：
  - userId: 用户ID
  - userName: 用户姓名
  - aiAnalysisCount: AI分析次数
  - aiTagsCount: AI标签数量
  - scriptUsageCount: 话术使用次数
  - knowledgeSearchCount: 知识搜索次数
  - totalUsageCount: 总使用次数
  - highQualityLeadsCount: A级线索数量
  - conversionRate: 转化率
- 排序：按总使用次数降序
- 显示：前10名
- 可视化：表格 + 奖牌🥇🥈🥉

**2. 客户质量分布**
- 数据项：
  - A级客户数量
  - B级客户数量
  - C级客户数量
  - D级客户数量
- 来源：AI聊天分析结果
- 可视化：饼图

**3. AI功能使用统计**
- 数据项：
  - chatAnalysis: 聊天分析次数
  - scriptGeneration: 话术生成次数
  - knowledgeSearch: 知识搜索次数
  - training: 培训陪练次数
  - riskAlert: 风险预警次数
  - marketing: 营销文案次数
- 可视化：柱状图

**4. 转化漏斗数据**
- 数据项：
  - leads: 线索数量
  - customers: 客户数量
  - intents: 意向客户数量
  - deals: 成交数量
- 计算：各阶段转化率
- 可视化：漏斗图

**5. 风险预警统计**
- 数据项：
  - 待处理风险数
  - 已处理风险数
  - 按风险等级分布
  - 按风险类型分布

#### 6.3 应用场景

**管理层使用**:
- 了解团队AI工具使用情况
- 评估AI工具对业绩的影响
- 识别高效销售的工作模式
- 发现需要培训的薄弱环节
- 优化AI工具配置

**数据权限**:
- 超级管理员：查看所有数据
- 销售主管：查看本部门数据
- 普通销售：无权限访问

**注意事项**:
- 当前版本部分数据使用模拟值
- 真实统计逻辑将在后续版本完善
- UI和数据结构已完整实现

---

### 7. AI诊断报告模块 (AI Diagnostic Reports) 🆕

**路由**: `/api/ai-tools/report`
**前端页面**: `/ai/reports`

#### 7.1 核心功能

**功能列表**:
- ✅ 生成诊断报告 (POST /ai-tools/report/generate)
  - 选择报告类型（周报/月报/季报）
  - 选择报告周期
  - 选择目标类型（个人/团队/全公司）
  - 异步生成（避免超时）
  - 状态跟踪
- ✅ 报告列表 (GET /ai-tools/report/list)
  - 分页查询
  - 按类型筛选
  - 按状态筛选
  - 按生成人筛选
- ✅ 报告详情 (GET /ai-tools/report/:id)
  - 完整报告内容
  - 可视化图表
  - 导出PDF（待实现）
- ✅ 删除报告 (DELETE /ai-tools/report/:id)

#### 7.2 报告类型（3种）

**1. 周报** - Week Report
- 周期：最近7天
- 更新频率：每周一自动生成
- 适用对象：销售个人、小团队

**2. 月报** - Month Report
- 周期：最近30天
- 更新频率：每月1号自动生成
- 适用对象：部门、分公司

**3. 季报** - Quarter Report
- 周期：最近90天
- 更新频率：每季度首日自动生成
- 适用对象：公司高层、战略决策

#### 7.3 报告内容结构

**1. 关键指标统计** (Key Metrics)
- 总客户数
- 新增客户数
- 高质量线索数（A级）
- 转化率
- 平均响应时间
- AI工具使用次数
- 客户满意度

**2. AI洞察发现** (AI Insights)
- 通过DeepSeek AI分析关键指标
- 生成3-5个洞察点
- 示例：
  - "本周新增客户数环比增长15%，主要来源于线上渠道"
  - "高质量线索转化率达32%，高于行业平均水平"
  - "AI工具使用频次与业绩呈正相关，建议加强推广"

**3. 问题诊断** (Problems)
- AI识别业务问题
- 生成3-5个问题点
- 示例：
  - "平均响应时间2.5小时，响应效率有待提升"
  - "客户流失率较高，需加强客户维护"
  - "部分销售AI工具使用率低，影响整体效率"

**4. 改进建议** (Recommendations)
- AI给出可行性建议
- 生成3-5条建议
- 示例：
  - "建立快速响应机制，目标1小时内首次响应"
  - "对高价值客户建立专属服务体系"
  - "开展AI工具使用培训，提升团队整体效能"

#### 7.4 生成流程

```
用户发起生成请求
    ↓
创建报告记录（状态：生成中）
    ↓
异步任务开始
    ↓
1. 收集关键指标数据
   - 客户数据
   - 订单数据
   - 跟进数据
   - AI使用数据
    ↓
2. 调用AI生成洞察
   - 构建提示词
   - 调用DeepSeek API
   - 解析AI响应
    ↓
3. 调用AI诊断问题
   - 分析指标异常
   - 识别业务瓶颈
   - 生成问题列表
    ↓
4. 调用AI生成建议
   - 基于问题诊断
   - 结合行业经验
   - 生成改进方案
    ↓
保存完整报告（状态：已完成）
    ↓
通知用户查看
```

#### 7.5 应用场景

**管理层使用**:
- 定期业务复盘
- 战略决策依据
- 团队绩效评估
- 问题快速定位

**销售个人使用**:
- 个人业绩总结
- 找出改进方向
- 对标优秀同事
- 制定行动计划

**数据表**:
- `ai_reports` - 诊断报告表

**字段说明**:
- id (主键)
- reportType (报告类型)
- reportPeriod (报告周期)
- targetType (目标类型)
- targetId (目标ID)
- reportData (原始数据, JSON)
- keyMetrics (关键指标, JSON)
- aiInsights (AI洞察, JSON数组)
- problems (问题诊断, JSON数组)
- recommendations (改进建议, JSON数组)
- status (状态: 生成中/已完成/失败)
- generateTime (生成时间)
- generator (生成人ID)
- createTime (创建时间)

**注意事项**:
- AI生成需要10-20秒
- 使用异步处理避免超时
- 可在列表页查看生成进度
- 生成失败会记录错误信息

---

## 📈 CRM统计模块 🆕

### CRM个人统计页面 (Personal Statistics)

**路由**: `/api/analytics/personal-stats/:userId`
**前端页面**: `/crm-stats`

#### 功能说明

这是一个为销售人员提供的个人数据中心，展示个人业绩和AI工具使用情况。

#### 数据内容

**1. 数据概览** (Summary)
- 总客户数
- 本月新增客户数
- 总订单数
- 本月新增订单数
- 订单总金额
- 本月订单金额

**2. 30天转化趋势** (Conversion Trend)
- 横轴：日期（最近30天）
- 纵轴：转化数量
- 折线图展示
- 显示趋势走向

**3. 客户生命周期分布** (Stage Distribution)
- 各阶段客户数量
- 饼图可视化
- 阶段：
  - 线索
  - 客户
  - 商机
  - 成交客户
  - 流失客户
  - 复购客户

**4. 客户来源分布** (Source Distribution)
- 各渠道客户数量
- 饼图可视化
- 来源渠道：
  - 线上咨询
  - 朋友推荐
  - 线下地推
  - 老客户转介绍
  - 其他

**5. AI工具使用统计** (AI Usage)
- 聊天分析次数
- 培训陪练次数
- 总使用次数统计

#### 应用场景

**销售人员使用**:
- 查看个人业绩完成情况
- 了解客户分布和来源
- 掌握转化趋势
- 评估AI工具使用效果
- 与团队平均对比

**特点**:
- 数据实时更新
- 可视化图表直观
- 只能查看个人数据（数据权限）
- 支持导出报表

---

## 🔧 系统支撑模块（6个）

### 1. 配置管理模块
- 系统参数配置
- 字典数据管理
- 业务规则配置

### 2. 缓存管理模块
- Redis缓存
- AI结果缓存（OCR 2小时，分析 1小时）
- 接口响应缓存

### 3. 定时任务模块
- 客户自动回收
- 数据统计汇总
- 报表自动生成
- 日志清理

### 4. 消息队列模块
- AI分析异步处理
- 报告生成异步处理
- 邮件发送队列

### 5. 数据权限模块
- 基于角色的权限控制（RBAC）
- 数据范围权限：
  - 全部数据
  - 本部门数据
  - 本校区数据
  - 仅本人数据
- 字段级权限控制

### 6. API接口限流
- 基于IP的限流
- 基于用户的限流
- 基于接口的限流

---

## 🗂️ 数据库实体清单（29个表）

### 核心业务表
1. **users** - 用户表
2. **roles** - 角色表
3. **permissions** - 权限表
4. **role_permissions** - 角色权限关联表
5. **department** - 部门表
6. **campus** - 校区表
7. **customers** - 客户表
8. **customer_follow_records** - 客户跟进记录表
9. **orders** - 订单表
10. **commission_rules** - 提成规则表
11. **commission_records** - 提成记录表
12. **operation_commission_records** - 运营提成记录表

### 系统管理表
13. **dict_type** - 字典类型表
14. **dict_data** - 字典数据表
15. **operation_log** - 操作日志表
16. **login_log** - 登录日志表
17. **notifications** - 通知消息表
18. **file_uploads** - 文件上传记录表

### 业务扩展表
19. **sales_targets** - 销售目标表
20. **okr** - OKR表
21. **user_hierarchy** - 用户层级关系表
22. **team_stats** - 团队统计表

### AI功能表
23. **ai_chat_records** - AI聊天分析记录表
24. **ai_customer_tags** - AI客户标签表
25. **ai_knowledge_base** - AI知识库表
26. **ai_scripts** - AI话术库表
27. **ai_training_records** - AI培训记录表
28. **ai_risk_alerts** - AI风险预警表
29. **ai_reports** - AI诊断报告表

---

## 👥 用户角色与权限

### 角色类型

**1. 超级管理员 (Super Admin)**
- 权限：所有功能
- 数据权限：全部数据
- 适用：系统管理员、公司高层

**2. 销售主管 (Sales Manager)**
- 权限：
  - 客户管理（全部）
  - 订单管理（全部）
  - 团队管理
  - 数据分析
  - AI工具（全部）
  - 目标管理
  - 提成查看
- 数据权限：本部门/本校区数据
- 适用：销售经理、区域经理

**3. 销售人员 (Sales)**
- 权限：
  - 客户管理（个人）
  - 订单管理（个人）
  - 跟进管理
  - AI工具（全部）
  - 个人目标
  - 个人提成
- 数据权限：仅本人数据
- 适用：销售顾问、客户经理

**4. 财务人员 (Finance)**
- 权限：
  - 财务管理
  - 提成管理
  - 订单查看
  - 财务报表
- 数据权限：全部财务数据
- 适用：财务会计、出纳

**5. 教务人员 (Academic)**
- 权限：
  - 客户查看
  - 订单查看
  - 课程管理
  - 学员管理
- 数据权限：全部学员数据
- 适用：教务老师、班主任

---

## 📊 关键业务流程

### 1. 客户获取与跟进流程

```
线索获取
  ↓
创建客户（线索阶段）
  ↓
初次联系
  ↓
需求挖掘 → AI聊天分析 → 自动打标签
  ↓
客户培育（多次跟进）
  ↓
意向提升（商机阶段）
  ↓
促成签单 → 创建订单
  ↓
成交客户 → 自动计算提成
  ↓
售后服务
  ↓
复购/转介绍
```

### 2. AI辅助销售流程

```
上传聊天截图
  ↓
OCR识别文字（豆包）
  ↓
AI分析客户（DeepSeek）
  ├─ 质量评级
  ├─ 意向评分
  ├─ 需求识别
  └─ 风险预警
  ↓
自动打标签（6类）
  ↓
更新客户意向
  ↓
生成跟进建议
  ↓
推荐话术场景
  ↓
销售执行跟进
```

### 3. 订单成交流程

```
创建订单
  ├─ 智能关联客户
  ├─ 填写课程信息
  └─ 填写金额信息
  ↓
订单待支付
  ↓
支付确认
  ├─ 更新订单状态
  ├─ **自动计算销售提成**
  ├─ **自动创建运营提成**（新学员）
  └─ 更新客户生命周期
  ↓
订单已支付
  ↓
开课通知
  ↓
售后服务
```

### 4. AI诊断报告生成流程

```
用户发起生成
  ↓
选择报告参数
  ├─ 报告类型（周/月/季）
  ├─ 报告周期
  └─ 目标对象
  ↓
创建报告记录（状态：生成中）
  ↓
【异步任务】
  ├─ 收集关键指标
  ├─ 调用AI生成洞察
  ├─ 调用AI诊断问题
  └─ 调用AI生成建议
  ↓
保存完整报告（状态：已完成）
  ↓
通知用户查看
```

---

## 🔌 API接口规范

### 请求规范

**Base URL**: `http://your-domain/api`

**认证方式**: JWT Bearer Token
```
Authorization: Bearer {token}
```

**请求格式**: JSON
```json
{
  "key": "value"
}
```

### 响应规范

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {...}
}
```

**失败响应**:
```json
{
  "code": 400,
  "message": "错误信息",
  "error": "详细错误"
}
```

**分页响应**:
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}
```

### HTTP状态码

- 200: 成功
- 201: 创建成功
- 400: 请求参数错误
- 401: 未授权
- 403: 无权限
- 404: 资源不存在
- 500: 服务器错误

---

## 🎨 前端页面清单（33个页面）

### 认证页面
1. `/login` - 登录页面

### 工作台页面
2. `/workspace` - 个人工作台
3. `/dashboard` - 管理看板

### 客户管理页面
4. `/customer/list` - 客户列表
5. `/customer/detail/:id` - 客户详情
6. `/customer/lifecycle-board` - 生命周期看板

### 订单管理页面
7. `/order/list` - 订单列表
8. `/order/dashboard` - 订单看板

### 财务管理页面
9. `/finance/overview` - 财务概览
10. `/commission/list` - 提成列表

### 团队管理页面
11. `/team/leaderboard` - 团队排行榜

### 目标管理页面
12. `/target/management` - 目标管理

### OKR管理页面
13. `/okr/list` - OKR列表

### 数据分析页面
14. `/analytics/sales-funnel` - 销售漏斗
15. `/analytics/advanced` - 高级分析

### AI智能助手页面
16. `/ai/chat-analysis` - AI聊天记录分析 ✅
17. `/ai/knowledge` - AI知识库 ✅
18. `/ai/tools` - AI工具中心 ✅
19. `/ai/marketing` - AI营销助手 🆕
20. `/ai/analytics` - AI人效分析 🆕
21. `/ai/reports` - AI诊断报告 🆕

### CRM统计页面
22. `/crm-stats` - CRM统计 🆕

### 系统管理页面
23. `/system/user` - 用户管理
24. `/system/role` - 角色管理
25. `/system/permission` - 权限管理
26. `/system/department` - 部门管理
27. `/system/campus` - 校区管理
28. `/system/dict` - 字典管理
29. `/system/operation-log` - 操作日志

### 个人中心页面
30. `/profile` - 个人资料

### 数据大屏页面
31. `/datascreen` - 数据大屏

### 其他页面
32. `/notification` - 通知中心
33. `/404` - 404页面

---

## 🔐 安全特性

### 认证安全
- ✅ JWT双Token机制
- ✅ Token自动刷新
- ✅ 密码bcrypt加密
- ✅ 登录失败限制
- ✅ 设备指纹识别

### 接口安全
- ✅ 权限验证（RBAC）
- ✅ 数据权限控制
- ✅ SQL注入防护（TypeORM）
- ✅ XSS防护（输入过滤）
- ✅ CSRF防护
- ⚠️ API限流（需配置）

### 数据安全
- ✅ 敏感数据加密存储
- ✅ 操作日志记录
- ✅ 数据备份（需配置）
- ✅ 数据导出脱敏

### 网络安全
- ✅ HTTPS加密传输（生产环境）
- ✅ CORS跨域控制
- ✅ 请求头校验

---

## 📱 响应式设计

### 支持设备
- ✅ PC桌面端（主要）
- ✅ 平板端（适配）
- ⚠️ 移动端（部分页面）

### 浏览器支持
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Edge 90+
- ✅ Safari 14+

---

## 🚀 性能优化

### 前端优化
- ✅ 组件懒加载
- ✅ 路由懒加载
- ✅ 图片懒加载
- ✅ Gzip压缩
- ✅ CDN加速（可配置）
- ✅ 生产构建移除console

### 后端优化
- ✅ 数据库查询优化
- ✅ 索引优化
- ✅ Redis缓存
- ✅ 接口响应缓存
- ✅ 分页查询
- ✅ N+1查询优化

### AI优化
- ✅ OCR结果缓存（2小时）
- ✅ 分析结果缓存（1小时）
- ✅ 异步处理（避免超时）
- ✅ 批量处理

---

## 📝 待完善功能说明

### AI模块待完善功能

**1. AI人效分析模块**
- 当前状态：UI完整，部分使用模拟数据
- 待完善：
  - `getUserAiUsageStats()` - 真实用户统计
  - `getCustomerQualityDistribution()` - 真实质量分布
  - `getAiFeatureUsageStats()` - 真实功能统计
  - `getConversionFunnel()` - 真实转化数据

**2. AI诊断报告模块**
- 当前状态：核心功能完整，部分使用模拟数据
- 待完善：
  - `collectKeyMetrics()` - 真实指标收集
  - AI生成逻辑已完整实现

**3. AI营销助手模块**
- 当前状态：核心功能完整
- 待完善：
  - `getMarketingContentHistory()` - 历史记录查询

### 影响评估
- ✅ 不影响功能演示
- ✅ 不影响用户体验
- ✅ UI和交互已完整
- ✅ 数据结构已完整
- ⏰ 可在后续版本完善

---

## 📊 系统统计

### 代码统计
- 后端代码：约15,000行
- 前端代码：约20,000行
- 数据库脚本：约3,000行
- 总计：约38,000行

### 文件统计
- 后端文件：约150个
- 前端文件：约200个
- 配置文件：约15个
- 文档文件：约10个

### API统计
- 总端点数：150+
- GET请求：约60个
- POST请求：约50个
- PUT请求：约25个
- DELETE请求：约15个

---

## 🎯 版本历史

### v2.0.0 (2025-01-07) - 当前版本
**新增功能**:
- ✅ AI营销助手（6种营销文案）
- ✅ AI人效分析看板
- ✅ AI诊断报告（周报/月报/季报）
- ✅ CRM统计页面
- ✅ 豆包OCR配置
- ✅ DeepSeek AI集成

**优化改进**:
- ✅ 移除所有console.log
- ✅ 修复CORS安全配置
- ✅ 优化数据库查询
- ✅ 完善部署文档

### v1.5.0 (2024-12)
**新增功能**:
- AI聊天记录分析
- AI知识库
- AI工具中心（4个子工具）
- AI客户标签

### v1.0.0 (2024-10)
**初始版本**:
- 客户管理
- 订单管理
- 提成管理
- 财务管理
- 基础系统功能

---

## 🔮 未来规划

### 短期规划（1-3个月）
- [ ] 完善AI人效分析真实数据统计
- [ ] 完善AI诊断报告真实数据收集
- [ ] 添加营销文案历史记录功能
- [ ] 增加更多AI分析场景
- [ ] 移动端适配优化

### 中期规划（3-6个月）
- [ ] 客户画像完善（更多维度）
- [ ] 智能推荐系统
- [ ] 自动化营销功能
- [ ] BI数据分析增强
- [ ] 微信小程序版本

### 长期规划（6-12个月）
- [ ] 多租户SaaS化
- [ ] AI大模型训练（专属模型）
- [ ] 语音AI助手
- [ ] 数据大屏2.0
- [ ] 开放API平台

---

## 📞 技术支持

### 系统信息
- **系统名称**：海绵青年教育CRM系统
- **系统版本**：v2.0.0
- **技术架构**：NestJS + Vue 3 + MySQL + Redis
- **AI能力**：DeepSeek + 豆包OCR
- **部署方式**：Docker + Docker Compose
- **CI/CD**：GitHub Actions

### 相关链接
- **GitHub仓库**：https://github.com/deji-li/haimianqingnian
- **部署文档**：完整部署上线手册.md
- **API文档**：http://your-domain/api（Swagger）

### 联系方式
- 遇到问题请查看部署文档
- 技术支持请提交GitHub Issues

---

**文档版本**：v2.0.0
**最后更新**：2025-01-07
**文档作者**：系统开发团队

---

## 📄 附录

### A. 常用字典枚举

**客户来源**:
- 线上咨询
- 朋友推荐
- 线下地推
- 老客户转介绍
- 自然流量
- 广告投放
- 活动报名
- 其他

**客户意向**:
- 高（70-100分）
- 中（40-69分）
- 低（0-39分）

**生命周期阶段**:
- 线索
- 客户
- 商机
- 成交客户
- 流失客户
- 复购客户

**订单状态**:
- 待支付
- 已支付
- 已取消
- 已退款

**支付方式**:
- 微信支付
- 支付宝
- 银行转账
- 现金
- 其他

### B. 快捷键说明

**全局快捷键**:
- `Ctrl/Cmd + K`：全局搜索
- `Ctrl/Cmd + N`：新建客户
- `Ctrl/Cmd + O`：新建订单
- `Ctrl/Cmd + ,`：打开设置

**页面快捷键**:
- `Enter`：确认/提交
- `Esc`：取消/关闭
- `Ctrl/Cmd + S`：保存

---

**END OF DOCUMENT**
